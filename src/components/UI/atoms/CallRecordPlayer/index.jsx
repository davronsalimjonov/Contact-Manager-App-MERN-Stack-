import { useEffect, useRef, useState } from 'react';
import { useWavesurfer } from '@wavesurfer/react';
import { cn } from '@/utils/lib';
import cls from './CallRecordPlayer.module.scss';

const peaks = [0.28025147318840027,-0.00811767578125,0.2547685205936432,-0.01385498046875,0.016205329447984695,-0.029205322265625,0.13736380636692047,-0.0628662109375,0.2715536952018738,-0.00927734375,0.19672231376171112,-0.020263671875,0.22775962948799133,-0.018218994140625,0.0004272591322660446,-0.000885009765625,0.058320872485637665,-0.0047607421875,0.035340435802936554,-0.038970947265625,0.05850398167967796,-0.017364501953125,0.05154576152563095,-0.16839599609375,0.0009155552834272385,-0.000335693359375,0.0006714072078466415,-0.0009765625,0.0004272591322660446,-0.00042724609375,0.00033570360392332077,-0.00048828125,0.00009155552834272385,-0.0015869140625,0.00006103701889514923,-0.000030517578125,0.00009155552834272385,0,0.001434369944036007,-0.000518798828125,0.00012207403779029846,-0.00042724609375,0.0002136295661330223,-0.00054931640625,0.0002441480755805969,-0.000518798828125,0.0009765923023223877,-0.003448486328125,0.0871913805603981,-0.150177001953125,0.04660176485776901,-0.01336669921875,0.17239905893802643,-0.0814208984375,0.12329477816820145,-0.02606201171875,0.04196295142173767,-0.06451416015625,0.03711050748825073,-0.00994873046875,0.0393993966281414,-0.03302001953125,0.00787377543747425,-0.07586669921875,0.05493331700563431,-0.09747314453125,0.01156651508063078,-0.136016845703125,0.0036011841148138046,-0.0008544921875,0.02063051238656044,-0.00665283203125,0.018402662128210068,-0.0045166015625,0.10470900684595108,-0.12518310546875,0.23676259815692902,-0.0001220703125,0.06201361119747162,-0.124542236328125,0.029114658012986183,-0.306884765625,0.0473952442407608,-0.05694580078125,0.03396710008382797,-0.063232421875,0.014526810497045517,-0.001007080078125,0.004150517284870148,-0.000457763671875,0.2855311632156372,-0.112548828125,0.13211463391780853,-0.004547119140625,0.1675466150045395,-0.22088623046875,0.23636585474014282,-0.00103759765625,0.18817712366580963,-0.040618896484375,0.0007324442267417908,-0.000823974609375,0.0012207403779029846,-0.00115966796875,0.17615284025669098,-0.213775634765625,0.20206305384635925,-0.141510009765625,0.2301705926656723,-0.087738037109375,0.12411877512931824,-0.0350341796875,0.018066957592964172,-0.084808349609375,0.048890650272369385,-0.115081787109375,0.008239997550845146,-0.017303466796875,0.09933774918317795,-0.026458740234375,0.05713064968585968,-0.0302734375,0.06732383370399475,-0.11688232421875,0.04519791156053543,-0.045135498046875,0.0010986663401126862,-0.001800537109375,0.08606219291687012,-0.097869873046875,0.0014038514345884323,-0.000701904296875,0.0012512588873505592,-0.00067138671875,0.00045777764171361923,-0.00042724609375,0.0024414807558059692,-0.001678466796875,0.006653035059571266,-0.001434326171875,0.004699850454926491,-0.004302978515625,0.030640583485364914,-0.01080322265625,0.06961271911859512,-0.10516357421875,0.044801171869039536,-0.140106201171875,0.006500442512333393,-0.03131103515625,0.13379314541816711,-0.016357421875,0.07419049739837646,-0.01123046875,0.030518509447574615,-0.09130859375,0.17175817489624023,-0.0372314453125,0.02447584457695484,-0.047027587890625,0.043885618448257446,-0.110198974609375,0.010406811721622944,-0.076995849609375,0.0003662221133708954,-0.000274658203125,0.025727104395627975,-0.0626220703125,0.024842066690325737,-0.05804443359375,0.012421033345162868,-0.068756103515625,0.07296975702047348,-0.016571044921875,0.04666280001401901,-0.028289794921875,0.0009460737928748131,-0.000335693359375,0.0005188146606087685,-0.000579833984375,0.05896176025271416,-0.053924560546875,0.02230903133749962,-0.047210693359375,0.015320291742682457,-0.002777099609375,0.0018616290763020515,-0.00091552734375,0.00198370311409235,-0.034515380859375,0.032807398587465286,-0.037139892578125,0.0015259254723787308,-0.00054931640625,0.008423108607530594,-0.00274658203125,0.005188146606087685,-0.000762939453125,0.0024109622463583946,-0.003814697265625,0.004028443247079849,-0.002471923828125,0.05209509655833244,-0.085235595703125,0.05331583693623543,-0.04302978515625,0.0796533077955246,-0.244537353515625,0.029663991183042526,-0.176788330078125,0.04510635882616043,-0.003082275390625,0.12991729378700256,-0.109222412109375,0.08581805229187012,-0.006866455078125,0.01992858573794365,-0.2158203125,0.28876614570617676,-0.09149169921875,0.003021332435309887,-0.06427001953125,0.0032349620014429092,-0.000244140625,0.04339732229709625,-0.18408203125,0.13660085201263428,-0.1490478515625,0.04147465527057648,-0.030242919921875,0.22614215314388275,-0.166046142578125,0.08972442150115967,-0.04266357421875,0.04419080168008804,-0.0579833984375,0.01834162324666977,-0.074951171875,0.06060975790023804,-0.063568115234375,0.0006408886983990669,-0.01177978515625,0.0006714072078466415,-0.0008544921875,0.0477309487760067,-0.203643798828125,0.09329508244991302,-0.066131591796875,0.053437910974025726,-0.034759521484375,0.0002441480755805969,-0.00030517578125,0.08862575143575668,-0.108551025390625,0.0031434064731001854,-0.108917236328125,0.0006408886983990669,-0.000396728515625,0.00030518509447574615,-0.000518798828125,0.022003844380378723,-0.00323486328125,0.01434369944036007,-0.006622314453125,0.012939848005771637,-0.01019287109375,0.006775109097361565,-0.057373046875,0.04144413769245148,-0.118896484375,0.0019531846046447754,-0.00042724609375,0.037659838795661926,-0.04571533203125,0.021607104688882828,-0.040069580078125,0.018066957592964172,-0.050201416015625,0.00878933072090149,-0.048828125,0.021851252764463425,-0.099334716796875,0.014923551119863987,-0.060546875,0.019226660951972008,-0.027587890625,0.0396130234003067,-0.029693603515625,0.04977568984031677,-0.01434326171875,0.043153174221515656,-0.042877197265625,0.052797019481658936,-0.002471923828125,0.09442427009344101,-0.01654052734375,0.03265480697154999,-0.03692626953125,0.032990507781505585,-0.044647216796875,0.0003662221133708954,-0.00384521484375,0.0098574785515666,-0.00146484375,0.13791313767433167,-0.200286865234375,0.036133915185928345,-0.098876953125,0.10574663430452347,-0.203521728515625,0.02630695514380932,-0.074493408203125,0.017151402309536934,-0.0126953125,0.023316141217947006,-0.00592041015625,0.039643544703722,-0.01611328125,0.00079348124563694,-0.003448486328125,0.0016479995101690292,-0.000823974609375,0.0025025177747011185,-0.000213623046875,0.04846339300274849,-0.01025390625,0.06772056967020035,-0.0166015625,0.032197028398513794,-0.00689697265625,0.023560289293527603,-0.030364990234375,0.006836146116256714,-0.019378662109375,0.01355021819472313,-0.0528564453125,0.03659169375896454,-0.01446533203125,0.010620441287755966,-0.059478759765625,0.028290659189224243,-0.0013427734375,0.02865688130259514,-0.03802490234375,0.008484145626425743,-0.031005859375,0.02294991910457611,-0.029022216796875,0.0007324442267417908,-0.0013427734375,0.002868739888072014,-0.001373291015625,0.002227851189672947,-0.00335693359375,0.04205450415611267,-0.0765380859375,0.013245033100247383,-0.099029541015625,0.05383465066552162,-0.041290283203125,0.0236823633313179,-0.058197021484375,0.0072634052485227585,-0.03863525390625,0.036011841148138046,-0.03607177734375,0.010040589608252048,-0.002716064453125,0.02871791645884514,-0.00299072265625,0.02148503065109253,-0.004150390625,0.02847376838326454,-0.095977783203125,0.021607104688882828,-0.02447509765625,0.017975401133298874,-0.009063720703125,0.03827021270990372,-0.00677490234375,0.043916136026382446,-0.012603759765625,0.00079348124563694,-0.001953125,0.0035096285864710808,-0.001739501953125,0.008911404758691788,-0.004150390625,0.06033509224653244,-0.13262939453125,0.28104496002197266,-0.13641357421875,0.1424909234046936,-0.102996826171875,0.043885618448257446,-0.01092529296875,0.12314218282699585,-0.07269287109375,0.11438336968421936,-0.219970703125,0.11621448397636414,-0.18719482421875,0.13745537400245667,-0.086578369140625,0.14600054919719696,-0.2998046875,0.2135074883699417,-0.311553955078125,0.22373118996620178,-0.1834716796875,0.002868739888072014,-0.042938232421875,0.007385479286313057,-0.001251220703125,0.0032959990203380585,-0.00262451171875,0.11020233482122421,-0.225616455078125,0.03573717549443245,-0.18756103515625,0.03329569473862648,-0.00152587890625,0.0013122959062457085,-0.000579833984375,0.0012817773967981339,-0.0010986328125,0.15689565241336823,-0.137664794921875,0.006439405493438244,-0.0557861328125,0.006836146116256714,-0.056396484375,0.09909360110759735,-0.126800537109375,0.15695668756961823,-0.274444580078125,0.03823969140648842,-0.022979736328125,0.006286812946200371,-0.29364013671875,0.009308145381510258,-0.22515869140625,0.27982422709465027,-0.12152099609375,0.06094546243548393,-0.21502685546875,0.3328959047794342,-0.09808349609375,0.13019196689128876,-0.163177490234375,0.10003967583179474,-0.19708251953125,0.08850367367267609,-0.14996337890625,0.012604144401848316,-0.009246826171875,0.05294961482286453,-0.093994140625,0.0006714072078466415,-0.010345458984375,0.24994659423828125,-0.06231689453125,0.26621297001838684,-0.1142578125,0.18485061824321747,-0.1260986328125,0.06561479717493057,-0.088592529296875,0.23322245478630066,-0.0341796875,0.01150547806173563,-0.03680419921875,0.02536088228225708,-0.040557861328125,0.057527389377355576,-0.06817626953125,0.0014038514345884323,-0.068572998046875,0.11224707961082458,-0.149749755859375,0.10190130025148392,-0.263671875,0.11639759689569473,-0.2930908203125,0.21973326802253723,-0.08551025390625,0.2937711775302887,-0.088287353515625,0.010681478306651115,-0.0081787109375,0.0157475508749485,-0.02984619140625,0.009735404513776302,-0.007965087890625,0.07593005150556564,-0.01849365234375,0.001831110566854477,-0.011627197265625,0.006164738908410072,-0.00048828125,0.0044862208887934685,-0.00091552734375,0.00027466658502817154,-0.0009765625,0.0024109622463583946,-0.000518798828125,0.001434369944036007,-0.0013427734375,0.006683553569018841,-0.003692626953125,0.003662221133708954,-0.0023193359375,0.0012207403779029846,-0.00079345703125,0.0032959990203380585,-0.011688232421875,0.004119998775422573,-0.0032958984375,0.006134220398962498,-0.005340576171875,0.008148442022502422,-0.00469970703125,0.002136295661330223,-0.0050048828125,0.002868739888072014,-0.003997802734375,0.005096591077744961,-0.003173828125,0.010132145136594772,-0.006439208984375,0.0036927396431565285,-0.000732421875,0.005920590832829475,-0.0052490234375,0.011139255948364735,-0.00396728515625,0.017242956906557083,-0.0030517578125,0.0030518509447574615,-0.00213623046875,0.08102664351463318,-0.4293212890625,0.09259315580129623,-0.044677734375,0.04986724257469177,-0.05511474609375,0.05453657731413841,-0.042572021484375,0.317117840051651,-0.04498291015625,0.09009063988924026,-0.01025390625,0.07843256741762161,-0.267822265625,0.0952177494764328,-0.014373779296875,0.15344706177711487,-0.1407470703125,0.09152501076459885,-0.021514892578125,0.006317331455647945,-0.104248046875,0.008209479041397572,-0.07916259765625,0.0397656187415123,-0.033905029296875,0.06170842796564102,-0.157928466796875,0.028199102729558945,-0.115997314453125,0.021637622267007828,-0.00787353515625,0.0008239997550845146,-0.0001220703125,0.07660146057605743,-0.045989990234375,0.05481124296784401,-0.044403076171875,0.027253028005361557,-0.046051025390625,0.0710165724158287,-0.062225341796875,0.034577470272779465,-0.01812744140625,0.0633564293384552,-0.064208984375,0.049592576920986176,-0.076690673828125,0.05313272401690483,-0.064208984375,0.0013733329251408577,-0.00054931640625,0.0016785180196166039,-0.104156494140625,0.0796533077955246,-0.1312255859375,0.0021668141707777977,-0.1446533203125,0.0032349620014429092,-0.007293701171875,null,null]

const CallRecordPlayer = ({
    className = '',
    url = '',
}) => {
    const containerRef = useRef()
    const [isAudioLoaded, setIsAudioLoaded] = useState(false);
    const { wavesurfer, isReady, isPlaying, currentTime } = useWavesurfer({
        container: containerRef,
        height: 24,
        barGap: 2,
        barWidth: 2,
        barHeight: 2,
        waveColor: 'rgba(61, 73, 98, 1)',
        progressColor: 'rgba(18, 86, 219, 1)',
        cursorColor: 'transparent',
        barAlign: 'bottom',
        peaks,
        normalize: true,
        duration: 210,
    })

    const onPlayPause = async () => {
            if (!isAudioLoaded && wavesurfer) {
                await wavesurfer.load(url);
                setIsAudioLoaded(true);
            }
            
            if (wavesurfer) {
                wavesurfer.playPause();
            }
    }

    useEffect(() => {
        if(wavesurfer){
            wavesurfer.on('loading', (percent) => {
                console.log(percent);
                
                // setLoadingProgress(percent);
            });
        }
    }, [wavesurfer])

    return (
        <div className={cn(cls.player, className)}>
            <button className={cls.player__btn} onClick={onPlayPause}>
                <div className={cn(cls.icon, isPlaying ? cls.paused : '')}></div>
            </button>
            <div ref={containerRef} style={{ flex: 1 }}></div>
        </div>
    );
}

export default CallRecordPlayer;